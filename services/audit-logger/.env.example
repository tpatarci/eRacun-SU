# =============================================
# Audit Logger Service - Environment Variables
# =============================================
# Copy this file to .env and customize for your environment
# NEVER commit .env to git (contains secrets)

# =============================================
# Service Configuration
# =============================================
NODE_ENV=production                    # production | staging | development | test
LOG_LEVEL=info                         # error | warn | info | debug
SERVICE_NAME=audit-logger
SERVICE_VERSION=1.0.0

# =============================================
# PostgreSQL Database
# =============================================
# Connection string format:
# postgresql://[user]:[password]@[host]:[port]/[database]?[options]
DATABASE_URL=postgresql://audit_user:CHANGE_ME@localhost:5432/audit_log

# Connection pool settings
DATABASE_POOL_MIN=10                   # Minimum connections (default: 10)
DATABASE_POOL_MAX=50                   # Maximum connections (default: 50)

# For DigitalOcean Managed Database:
# DATABASE_URL=postgresql://doadmin:PASSWORD@your-cluster-do-user-123456-0.db.ondigitalocean.com:25060/audit_log?sslmode=require

# =============================================
# Kafka Consumer
# =============================================
# Comma-separated list of broker addresses
KAFKA_BROKERS=localhost:9092

# Topic to consume audit events from
KAFKA_TOPIC=audit-log

# Consumer group ID (for offset management)
KAFKA_GROUP_ID=audit-logger-group

# Consumer configuration
KAFKA_SESSION_TIMEOUT_MS=30000         # Session timeout (default: 30000)
KAFKA_HEARTBEAT_INTERVAL_MS=3000       # Heartbeat interval (default: 3000)
KAFKA_MAX_POLL_RECORDS=100             # Max records per poll (default: 100)

# For production (multiple brokers):
# KAFKA_BROKERS=kafka1.eracun.internal:9092,kafka2.eracun.internal:9092,kafka3.eracun.internal:9092

# =============================================
# gRPC Server
# =============================================
# Port for gRPC query API
GRPC_PORT=50051

# gRPC server options
GRPC_MAX_RECEIVE_MESSAGE_LENGTH=4194304    # 4 MB (default)
GRPC_MAX_SEND_MESSAGE_LENGTH=4194304        # 4 MB (default)

# =============================================
# HTTP Server (Health & Metrics)
# =============================================
# Port for HTTP endpoints
HTTP_PORT=8080

# Health check endpoint: GET /health
# Metrics endpoint: GET /metrics (Prometheus format)

# =============================================
# Observability
# =============================================
# Jaeger tracing endpoint
JAEGER_ENDPOINT=http://localhost:14268/api/traces

# Sampling rate (0.0 to 1.0)
# 1.0 = 100% sampling (production: consider 0.1 for 10%)
TRACING_SAMPLE_RATE=1.0

# Service name for distributed tracing
OTEL_SERVICE_NAME=audit-logger

# =============================================
# Performance Tuning
# =============================================
# Write batch size (not yet implemented - future optimization)
# WRITE_BATCH_SIZE=50

# Hash chain verification interval (hours)
# INTEGRITY_CHECK_INTERVAL_HOURS=24

# =============================================
# Security
# =============================================
# Enable TLS for gRPC (production only)
# GRPC_TLS_ENABLED=true
# GRPC_TLS_CERT_PATH=/etc/eracun/certs/server.crt
# GRPC_TLS_KEY_PATH=/etc/eracun/certs/server.key

# Enable TLS for Kafka (production only)
# KAFKA_SSL_ENABLED=true
# KAFKA_SSL_CA_PATH=/etc/eracun/certs/ca.crt
# KAFKA_SSL_CERT_PATH=/etc/eracun/certs/client.crt
# KAFKA_SSL_KEY_PATH=/etc/eracun/certs/client.key

# =============================================
# Development / Testing
# =============================================
# Test database URL (only for tests)
TEST_DATABASE_URL=postgresql://test:test@localhost:5432/audit_test

# Mock Kafka (for local development without Kafka)
# KAFKA_MOCK_MODE=true

# =============================================
# Croatian Regulatory Compliance
# =============================================
# Audit log retention period (years)
AUDIT_RETENTION_YEARS=11               # Croatian law requires 11 years

# Archive tier cutoff (days)
# Events older than this may be moved to cold storage
AUDIT_ARCHIVE_CUTOFF_DAYS=365

# =============================================
# Monitoring Alerts
# =============================================
# Alert thresholds (for external monitoring systems)
ALERT_DB_CONNECTION_POOL_THRESHOLD=45  # Alert if pool usage > 45/50
ALERT_KAFKA_LAG_THRESHOLD=1000         # Alert if consumer lag > 1000 messages
ALERT_WRITE_DURATION_P99_MS=1000       # Alert if p99 write latency > 1s

# =============================================
# Deployment
# =============================================
# Deployment environment identifier
DEPLOYMENT_ENV=production              # production | staging | development

# Droplet/server identifier
DEPLOYMENT_HOST=droplet-01.eracun.internal

# Git commit hash (set by CI/CD)
# GIT_COMMIT_SHA=abc123def456

# =============================================
# Feature Flags (Future)
# =============================================
# Enable experimental features
# FEATURE_BATCH_WRITES=false
# FEATURE_ASYNC_INTEGRITY_CHECK=false

# =============================================
# Notes
# =============================================
# 1. All timestamps are in Unix milliseconds (epoch)
# 2. All durations are in milliseconds unless specified
# 3. All memory sizes are in bytes unless specified
# 4. Database connection string supports PostgreSQL 12+
# 5. For production, use strong passwords (min 32 characters)
# 6. Enable TLS for all network communication in production
# 7. Use managed database for production (DigitalOcean Managed Database)
# 8. Monitor Kafka consumer lag (should be < 100 in production)
# 9. Set LOG_LEVEL=error in production to reduce noise
# 10. Ensure DATABASE_POOL_MAX matches database connection limits
